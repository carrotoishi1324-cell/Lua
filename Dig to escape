-- MACROPEAK | Dig to Escape Script
-- Made By @LuaDev
-- Game: https://www.roblox.com/id/games/92122513197996/Dig-to-Escape
-- Key: ASP

-- Key System
local Key = "ASP"
local function CheckKey()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = game:GetService("CoreGui")
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 400, 0, 250)
    Frame.Position = UDim2.new(0.5, -200, 0.5, -125)
    Frame.BackgroundColor3 = Color3.fromRGB(20, 25, 35)
    Frame.BorderSizePixel = 0
    Frame.Active = true
    Frame.Draggable = true
    Frame.Parent = ScreenGui
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = Frame
    
    local TopBar = Instance.new("Frame")
    TopBar.Size = UDim2.new(1, 0, 0, 50)
    TopBar.BackgroundColor3 = Color3.fromRGB(30, 40, 55)
    TopBar.BorderSizePixel = 0
    TopBar.Parent = Frame
    
    local UICorner2 = Instance.new("UICorner")
    UICorner2.CornerRadius = UDim.new(0, 12)
    UICorner2.Parent = TopBar
    
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 1, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "‚õèÔ∏è MACROPEAK | Dig to Escape"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 22
    Title.Font = Enum.Font.GothamBold
    Title.Parent = TopBar
    
    local Subtitle = Instance.new("TextLabel")
    Subtitle.Size = UDim2.new(1, 0, 0, 20)
    Subtitle.Position = UDim2.new(0, 0, 0, 55)
    Subtitle.BackgroundTransparency = 1
    Subtitle.Text = "Made By @LuaDev"
    Subtitle.TextColor3 = Color3.fromRGB(180, 200, 220)
    Subtitle.TextSize = 14
    Subtitle.Font = Enum.Font.Gotham
    Subtitle.Parent = Frame
    
    local KeyBox = Instance.new("TextBox")
    KeyBox.Size = UDim2.new(0.8, 0, 0, 45)
    KeyBox.Position = UDim2.new(0.1, 0, 0.3, 0)
    KeyBox.BackgroundColor3 = Color3.fromRGB(35, 45, 60)
    KeyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    KeyBox.PlaceholderText = "Enter Key..."
    KeyBox.PlaceholderColor3 = Color3.fromRGB(150, 170, 190)
    KeyBox.Text = ""
    KeyBox.TextSize = 18
    KeyBox.Font = Enum.Font.Gotham
    KeyBox.ClearTextOnFocus = false
    KeyBox.Parent = Frame
    
    local UICorner3 = Instance.new("UICorner")
    UICorner3.CornerRadius = UDim.new(0, 8)
    UICorner3.Parent = KeyBox
    
    local SubmitBtn = Instance.new("TextButton")
    SubmitBtn.Size = UDim2.new(0.6, 0, 0, 45)
    SubmitBtn.Position = UDim2.new(0.2, 0, 0.6, 0)
    SubmitBtn.BackgroundColor3 = Color3.fromRGB(90, 140, 255)
    SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    SubmitBtn.Text = "ACTIVATE SCRIPT"
    SubmitBtn.TextSize = 16
    SubmitBtn.Font = Enum.Font.GothamBold
    SubmitBtn.Parent = Frame
    
    local UICorner4 = Instance.new("UICorner")
    UICorner4.CornerRadius = UDim.new(0, 8)
    UICorner4.Parent = SubmitBtn
    
    local Hint = Instance.new("TextLabel")
    Hint.Size = UDim2.new(1, 0, 0, 20)
    Hint.Position = UDim2.new(0, 0, 0.9, 0)
    Hint.BackgroundTransparency = 1
    Hint.Text = "Key: ASP"
    Hint.TextColor3 = Color3.fromRGB(150, 180, 210)
    Hint.TextSize = 12
    Hint.Font = Enum.Font.Gotham
    Hint.Parent = Frame
    
    local function VerifyKey()
        if KeyBox.Text == Key then
            ScreenGui:Destroy()
            return true
        else
            KeyBox.Text = ""
            KeyBox.PlaceholderText = "‚ùå Wrong Key! Try: ASP"
            KeyBox.PlaceholderColor3 = Color3.fromRGB(255, 100, 100)
            return false
        end
    end
    
    SubmitBtn.MouseButton1Click:Connect(VerifyKey)
    KeyBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            VerifyKey()
        end
    end)
    
    repeat
        task.wait()
    until not ScreenGui.Parent
    
    return true
end

if not CheckKey() then return end

-- Load Rayfield UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create Window
local Window = Rayfield:CreateWindow({
    Name = "‚õèÔ∏è MACROPEAK | Dig to Escape",
    LoadingTitle = "Loading Dig to Escape Script...",
    LoadingSubtitle = "Made By @LuaDev | Key: ASP",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MACROPEAK_DIGTOESCAPE",
        FileName = "Config"
    }
})

-- Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Game Variables
local GameEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("GameEvent")
local Map = Workspace:WaitForChild("Map")
local DigItems = {}

-- Auto Dig Tab
local AutoDigTab = Window:CreateTab("Auto Dig", 6031304514)

local DigSection = AutoDigTab:CreateSection("Auto Dig Features")

-- Auto Dig Toggle
local AutoDigEnabled = false
local AutoDigToggle = AutoDigTab:CreateToggle({
    Name = "‚õèÔ∏è Auto Dig",
    CurrentValue = false,
    Flag = "AutoDig",
    Callback = function(Value)
        AutoDigEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Dig",
                Content = "Enabled - Automatically digging",
                Duration = 3
            })
        end
    end,
})

-- Auto Dig Speed
local DigSpeed = 0.1
local DigSpeedSlider = AutoDigTab:CreateSlider({
    Name = "Dig Speed",
    Range = {0.05, 2},
    Increment = 0.05,
    Suffix = "seconds",
    CurrentValue = 0.1,
    Flag = "DigSpeed",
    Callback = function(Value)
        DigSpeed = Value
    end,
})

-- Auto Pickup Items
local AutoPickupEnabled = false
local AutoPickupToggle = AutoDigTab:CreateToggle({
    Name = "üì¶ Auto Pickup Items",
    CurrentValue = false,
    Flag = "AutoPickup",
    Callback = function(Value)
        AutoPickupEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Pickup",
                Content = "Enabled - Auto collecting dug items",
                Duration = 3
            })
        end
    end,
})

-- Auto Upgrade Tools
local AutoUpgradeEnabled = false
local AutoUpgradeToggle = AutoDigTab:CreateToggle({
    Name = "‚ö° Auto Upgrade Tools",
    CurrentValue = false,
    Flag = "AutoUpgrade",
    Callback = function(Value)
        AutoUpgradeEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Upgrade",
                Content = "Enabled - Auto upgrading tools",
                Duration = 3
            })
        end
    end,
})

-- Auto Rebirth
local AutoRebirthEnabled = false
local AutoRebirthToggle = AutoDigTab:CreateToggle({
    Name = "üîÑ Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        AutoRebirthEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Rebirth",
                Content = "Enabled - Auto rebirthing when possible",
                Duration = 3
            })
        end
    end,
})

-- Rebirth Threshold
local RebirthThreshold = 1000
local RebirthSlider = AutoDigTab:CreateSlider({
    Name = "Rebirth Threshold",
    Range = {100, 10000},
    Increment = 100,
    Suffix = "coins",
    CurrentValue = 1000,
    Flag = "RebirthThreshold",
    Callback = function(Value)
        RebirthThreshold = Value
    end,
})

-- Teleport Tab
local TeleportTab = Window:CreateTab("Teleport", 6031075940)

local TeleportSection = TeleportTab:CreateSection("Teleport Locations")

-- Teleport to Best Spot
local TeleportBestBtn = TeleportTab:CreateButton({
    Name = "üìç Teleport to Best Spot",
    Callback = function()
        local bestSpot = Workspace:FindFirstChild("BestDigSpot") or Map:FindFirstChild("DigArea")
        if bestSpot then
            LocalPlayer.Character:MoveTo(bestSpot.Position + Vector3.new(0, 5, 0))
            Window:Notify({
                Title = "Teleport",
                Content = "Teleported to best digging spot",
                Duration = 3
            })
        else
            LocalPlayer.Character:MoveTo(Vector3.new(0, 100, 0))
        end
    end,
})

-- Teleport to Shop
local TeleportShopBtn = TeleportTab:CreateButton({
    Name = "üè™ Teleport to Shop",
    Callback = function()
        local shop = Workspace:FindFirstChild("Shop") or Map:FindFirstChild("ShopArea")
        if shop then
            LocalPlayer.Character:MoveTo(shop.Position + Vector3.new(0, 5, 0))
            Window:Notify({
                Title = "Teleport",
                Content = "Teleported to shop",
                Duration = 3
            })
        end
    end,
})

-- Teleport to Spawn
local TeleportSpawnBtn = TeleportTab:CreateButton({
    Name = "üö© Teleport to Spawn",
    Callback = function()
        local spawn = Workspace:FindFirstChild("SpawnLocation") or Map:FindFirstChild("Spawn")
        if spawn then
            LocalPlayer.Character:MoveTo(spawn.Position + Vector3.new(0, 5, 0))
            Window:Notify({
                Title = "Teleport",
                Content = "Teleported to spawn",
                Duration = 3
            })
        end
    end,
})

-- Auto Teleport to Rich Areas
local AutoTeleportEnabled = false
local AutoTeleportToggle = TeleportTab:CreateToggle({
    Name = "üöÄ Auto Teleport to Rich Areas",
    CurrentValue = false,
    Flag = "AutoTeleport",
    Callback = function(Value)
        AutoTeleportEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Teleport",
                Content = "Enabled - Auto teleporting to rich areas",
                Duration = 3
            })
        end
    end,
})

-- Player Tab
local PlayerTab = Window:CreateTab("Player", 6031280881)

local PlayerSection = PlayerTab:CreateSection("Player Modifications")

-- Speed Hack
local SpeedEnabled = false
local SpeedMultiplier = 3
local SpeedToggle = PlayerTab:CreateToggle({
    Name = "üèÉ Speed Hack",
    CurrentValue = false,
    Flag = "SpeedHack",
    Callback = function(Value)
        SpeedEnabled = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            if Value then
                LocalPlayer.Character.Humanoid.WalkSpeed = 16 * SpeedMultiplier
            else
                LocalPlayer.Character.Humanoid.WalkSpeed = 16
            end
        end
    end,
})

local SpeedSlider = PlayerTab:CreateSlider({
    Name = "Speed Multiplier",
    Range = {1, 10},
    Increment = 0.5,
    Suffix = "x",
    CurrentValue = 3,
    Flag = "SpeedMultiplier",
    Callback = function(Value)
        SpeedMultiplier = Value
        if SpeedEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = 16 * Value
        end
    end,
})

-- Jump Hack
local JumpEnabled = false
local JumpHeight = 100
local JumpToggle = PlayerTab:CreateToggle({
    Name = "ü¶ò High Jump",
    CurrentValue = false,
    Flag = "HighJump",
    Callback = function(Value)
        JumpEnabled = Value
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            if Value then
                LocalPlayer.Character.Humanoid.JumpHeight = JumpHeight
            else
                LocalPlayer.Character.Humanoid.JumpHeight = 50
            end
        end
    end,
})

local JumpSlider = PlayerTab:CreateSlider({
    Name = "Jump Height",
    Range = {50, 500},
    Increment = 10,
    Suffix = "studs",
    CurrentValue = 100,
    Flag = "JumpHeight",
    Callback = function(Value)
        JumpHeight = Value
        if JumpEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpHeight = Value
        end
    end,
})

-- No Clip
local NoClipEnabled = false
local NoClipToggle = PlayerTab:CreateToggle({
    Name = "üëª No Clip",
    CurrentValue = false,
    Flag = "NoClip",
    Callback = function(Value)
        NoClipEnabled = Value
        if Value then
            Window:Notify({
                Title = "No Clip",
                Content = "Enabled - Walk through walls",
                Duration = 3
            })
        end
    end,
})

-- Infinite Stamina
local InfiniteStaminaEnabled = false
local InfiniteStaminaToggle = PlayerTab:CreateToggle({
    Name = "‚ö° Infinite Stamina",
    CurrentValue = false,
    Flag = "InfiniteStamina",
    Callback = function(Value)
        InfiniteStaminaEnabled = Value
        if Value then
            Window:Notify({
                Title = "Infinite Stamina",
                Content = "Enabled - Unlimited stamina",
                Duration = 3
            })
        end
    end,
})

-- Auto Farm Tab
local AutoFarmTab = Window:CreateTab("Auto Farm", 6031068426)

local FarmSection = AutoFarmTab:CreateSection("Auto Farm Settings")

-- Auto Farm Coins
local AutoFarmEnabled = false
local AutoFarmToggle = AutoFarmTab:CreateToggle({
    Name = "üí∞ Auto Farm Coins",
    CurrentValue = false,
    Flag = "AutoFarm",
    Callback = function(Value)
        AutoFarmEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Farm",
                Content = "Enabled - Farming coins automatically",
                Duration = 3
            })
        end
    end,
})

-- Auto Sell Items
local AutoSellEnabled = false
local AutoSellToggle = AutoFarmTab:CreateToggle({
    Name = "üìà Auto Sell Items",
    CurrentValue = false,
    Flag = "AutoSell",
    Callback = function(Value)
        AutoSellEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Sell",
                Content = "Enabled - Auto selling collected items",
                Duration = 3
            })
        end
    end,
})

-- Auto Buy Upgrades
local AutoBuyEnabled = false
local AutoBuyToggle = AutoFarmTab:CreateToggle({
    Name = "üõí Auto Buy Upgrades",
    CurrentValue = false,
    Flag = "AutoBuy",
    Callback = function(Value)
        AutoBuyEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Buy",
                Content = "Enabled - Auto buying upgrades",
                Duration = 3
            })
        end
    end,
})

-- ESP Tab
local ESPTab = Window:CreateTab("ESP", 6031280881)

local ESPSection = ESPTab:CreateSection("ESP Features")

-- Item ESP
local ItemESPEnabled = false
local ItemESPToggle = ESPTab:CreateToggle({
    Name = "üì¶ Item ESP",
    CurrentValue = false,
    Flag = "ItemESP",
    Callback = function(Value)
        ItemESPEnabled = Value
        if Value then
            Window:Notify({
                Title = "Item ESP",
                Content = "Enabled - Showing items through walls",
                Duration = 3
            })
        end
    end,
})

-- Rare Item ESP
local RareESPEnabled = false
local RareESPToggle = ESPTab:CreateToggle({
    Name = "üíé Rare Item ESP",
    CurrentValue = false,
    Flag = "RareESP",
    Callback = function(Value)
        RareESPEnabled = Value
        if Value then
            Window:Notify({
                Title = "Rare ESP",
                Content = "Enabled - Highlighting rare items",
                Duration = 3
            })
        end
    end,
})

-- NPC ESP
local NPCESPEnabled = false
local NPCESPToggle = ESPTab:CreateToggle({
    Name = "üë§ NPC ESP",
    CurrentValue = false,
    Flag = "NPCESP",
    Callback = function(Value)
        NPCESPEnabled = Value
        if Value then
            Window:Notify({
                Title = "NPC ESP",
                Content = "Enabled - Showing NPC locations",
                Duration = 3
            })
        end
    end,
})

-- Visuals Tab
local VisualsTab = Window:CreateTab("Visuals", 6031068426)

local VisualsSection = VisualsTab:CreateSection("Visual Mods")

-- Remove Fog
local RemoveFogEnabled = false
local RemoveFogToggle = VisualsTab:CreateToggle({
    Name = "üå´Ô∏è Remove Fog",
    CurrentValue = false,
    Flag = "RemoveFog",
    Callback = function(Value)
        RemoveFogEnabled = Value
        if Value then
            game:GetService("Lighting").FogEnd = 1000000
        else
            game:GetService("Lighting").FogEnd = 1000
        end
    end,
})

-- Full Bright
local FullBrightEnabled = false
local FullBrightToggle = VisualsTab:CreateToggle({
    Name = "üí° Full Bright",
    CurrentValue = false,
    Flag = "FullBright",
    Callback = function(Value)
        FullBrightEnabled = Value
        if Value then
            game:GetService("Lighting").GlobalShadows = false
            game:GetService("Lighting").Brightness = 2
        else
            game:GetService("Lighting").GlobalShadows = true
            game:GetService("Lighting").Brightness = 1
        end
    end,
})

-- Misc Tab
local MiscTab = Window:CreateTab("Misc", 6031280881)

local MiscSection = MiscTab:CreateSection("Miscellaneous Features")

-- Auto Clicker
local AutoClickerEnabled = false
local AutoClickerToggle = MiscTab:CreateToggle({
    Name = "üñ±Ô∏è Auto Clicker",
    CurrentValue = false,
    Flag = "AutoClicker",
    Callback = function(Value)
        AutoClickerEnabled = Value
        if Value then
            Window:Notify({
                Title = "Auto Clicker",
                Content = "Enabled - Auto clicking",
                Duration = 3
            })
        end
    end,
})

-- Anti AFK
local AntiAFKEnabled = false
local AntiAFKToggle = MiscTab:CreateToggle({
    Name = "‚è∞ Anti AFK",
    CurrentValue = false,
    Flag = "AntiAFK",
    Callback = function(Value)
        AntiAFKEnabled = Value
        if Value then
            Window:Notify({
                Title = "Anti AFK",
                Content = "Enabled - Preventing AFK kick",
                Duration = 3
            })
        end
    end,
})

-- Collect All Nearby Items
local CollectAllBtn = MiscTab:CreateButton({
    Name = "üéÅ Collect All Nearby Items",
    Callback = function()
        Window:Notify({
            Title = "Collecting",
            Content = "Collecting all nearby items...",
            Duration = 3
        })
        
        -- Collect nearby items
        for _, item in pairs(Workspace:GetChildren()) do
            if item.Name:find("Item") or item.Name:find("Coin") or item.Name:find("Chest") then
                if item:IsA("BasePart") then
                    local args = {
                        "PickupDigItem",
                        tostring(item)
                    }
                    pcall(function()
                        GameEvent:FireServer(unpack(args))
                    end)
                end
            end
        end
    end,
})

-- Script Functions
local ESPDrawings = {}

-- Function to dig
local function Dig()
    if not AutoDigEnabled then return end
    
    local tool = Instance.new("Tool")
    local args = {"UseTool", tool}
    
    pcall(function()
        GameEvent:FireServer(unpack(args))
    end)
    
    tool:Destroy()
end

-- Function to pickup item
local function PickupItem(itemId)
    if not AutoPickupEnabled then return end
    
    local args = {"PickupDigItem", itemId}
    
    pcall(function()
        GameEvent:FireServer(unpack(args))
    end)
end

-- Function to attempt trade
local function AttemptTrade(npc)
    local args = {"AttemptTrade", npc}
    
    pcall(function()
        GameEvent:FireServer(unpack(args))
    end)
end

-- Function to update ESP
local function UpdateESP()
    if not ItemESPEnabled then
        for _, drawing in pairs(ESPDrawings) do
            drawing:Remove()
        end
        ESPDrawings = {}
        return
    end
    
    -- Find items in workspace
    for _, item in pairs(Workspace:GetDescendants()) do
        if item:IsA("BasePart") and (item.Name:find("Item") or item.Name:find("Coin") or item.Name:find("Chest") or item.Name:find("Gem")) then
            local pos = item.Position
            local camera = Workspace.CurrentCamera
            
            if camera then
                local screenPos, onScreen = camera:WorldToScreenPoint(pos)
                
                if onScreen then
                    if not ESPDrawings[item] then
                        local drawing = Drawing.new("Text")
                        drawing.Text = item.Name
                        drawing.Size = 14
                        
                        -- Color based on rarity
                        if item.Name:find("Gem") or item.Name:find("Rare") then
                            drawing.Color = Color3.fromRGB(255, 215, 0) -- Gold for rare
                        elseif item.Name:find("Coin") then
                            drawing.Color = Color3.fromRGB(255, 255, 0) -- Yellow for coins
                        else
                            drawing.Color = Color3.fromRGB(0, 255, 0) -- Green for normal
                        end
                        
                        drawing.Outline = true
                        drawing.Center = true
                        ESPDrawings[item] = drawing
                    end
                    
                    ESPDrawings[item].Position = Vector2.new(screenPos.X, screenPos.Y)
                    ESPDrawings[item].Visible = true
                elseif ESPDrawings[item] then
                    ESPDrawings[item].Visible = false
                end
            end
        end
    end
end

-- Function for No Clip
local function NoClipFunction()
    if not NoClipEnabled or not LocalPlayer.Character then return end
    
    for _, part in pairs(LocalPlayer.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end

-- Function for Anti AFK
local function AntiAFKFunction()
    if not AntiAFKEnabled then return end
    
    local VirtualUser = game:GetService("VirtualUser")
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end

-- Function to auto farm
local function AutoFarmFunction()
    if not AutoFarmEnabled then return end
    
    -- Dig
    Dig()
    
    -- Look for items to pickup
    for _, item in pairs(Workspace:GetDescendants()) do
        if item:IsA("BasePart") and item.Name:find("Item") then
            if LocalPlayer.Character then
                local distance = (LocalPlayer.Character.HumanoidRootPart.Position - item.Position).Magnitude
                if distance < 50 then
                    PickupItem(item.Name)
                end
            end
        end
    end
end

-- Function to auto upgrade
local function AutoUpgradeFunction()
    if not AutoUpgradeEnabled then return end
    
    -- Try to find upgrade NPCs
    local npcs = Map:FindFirstChild("Functional")
    if npcs then
        local spawnedNPCs = npcs:FindFirstChild("SpawnedNPCs")
        if spawnedNPCs then
            for _, npc in pairs(spawnedNPCs:GetChildren()) do
                if npc.Name:find("Frank") or npc.Name:find("Trader") or npc.Name:find("Merchant") then
                    AttemptTrade(npc)
                end
            end
        end
    end
end

-- Function to auto rebirth
local function AutoRebirthFunction()
    if not AutoRebirthEnabled then return end
    
    -- Check if player has enough coins for rebirth
    -- This would need to be adjusted based on actual game mechanics
    local canRebirth = true -- Placeholder
    
    if canRebirth then
        local args = {"Rebirth"}
        pcall(function()
            GameEvent:FireServer(unpack(args))
        end)
    end
end

-- Main Loop
RunService.Heartbeat:Connect(function(deltaTime)
    -- Update ESP
    UpdateESP()
    
    -- No Clip
    NoClipFunction()
    
    -- Auto Dig
    if AutoDigEnabled then
        Dig()
        task.wait(DigSpeed)
    end
    
    -- Auto Farm
    if AutoFarmEnabled then
        AutoFarmFunction()
    end
    
    -- Auto Upgrade
    if AutoUpgradeEnabled then
        AutoUpgradeFunction()
    end
    
    -- Auto Rebirth
    if AutoRebirthEnabled then
        AutoRebirthFunction()
    end
    
    -- Auto Teleport
    if AutoTeleportEnabled then
        -- Find rich area and teleport
        local richArea = Workspace:FindFirstChild("RichArea") or Map:FindFirstChild("RichDigSpot")
        if richArea then
            LocalPlayer.Character:MoveTo(richArea.Position + Vector3.new(0, 5, 0))
        end
    end
end)

-- Auto Clicker Loop
spawn(function()
    while task.wait(0.1) do
        if AutoClickerEnabled then
            -- Simulate mouse click
            mouse1click()
        end
        
        -- Anti AFK
        if AntiAFKEnabled then
            AntiAFKFunction()
        end
    end
end)

-- Character Added Event
LocalPlayer.CharacterAdded:Connect(function(character)
    task.wait(2)
    
    -- Apply speed if enabled
    if SpeedEnabled and character:FindFirstChild("Humanoid") then
        character.Humanoid.WalkSpeed = 16 * SpeedMultiplier
    end
    
    -- Apply jump if enabled
    if JumpEnabled and character:FindFirstChild("Humanoid") then
        character.Humanoid.JumpHeight = JumpHeight
    end
end)

-- Initial Notification
Window:Notify({
    Title = "‚õèÔ∏è MACROPEAK | Dig to Escape",
    Content = "Script loaded successfully!\nKey: ASP\nMade By @LuaDev\nGame Event Hooked Successfully",
    Duration = 8
})

-- Script Info
Window:CreateLabel("MACROPEAK | Dig to Escape Script")
Window:CreateLabel("Made By @LuaDev")
Window:CreateLabel("Key: ASP (Verified)")
Window:CreateLabel("Version: 1.0.0")
Window:CreateLabel("Game Event: " .. tostring(GameEvent))

print("[MACROPEAK] Dig to Escape Script Loaded")
print("[MACROPEAK] Key: ASP")
print("[MACROPEAK] Game Event Hooked: " .. tostring(GameEvent))
print("[MACROPEAK] All features ready!")
